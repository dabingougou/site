---
import '../../styles/global.css';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const papers = await getCollection('papers');
  return papers.map((paper) => ({ params: { slug: paper.slug }, props: { paper } }));
}

const { paper } = Astro.props;
const { Content } = await render(paper);
const base = import.meta.env.BASE_URL;
const basePrefix = base.endsWith('/') ? base : base + '/';
const href = (path = '') => basePrefix + String(path).replace(/^\/+/, '');
const cfToken = import.meta.env.PUBLIC_CF_WEB_ANALYTICS_TOKEN || "0efd8831b429400cad16a61e9fb30df6";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{paper.data.title}</title>
    {cfToken && (
      <script
        defer
        src="https://static.cloudflareinsights.com/beacon.min.js"
        data-cf-beacon={`{"token":"${cfToken}"}`}
      ></script>
    )}

  </head>
  <body>
    <main class="container">
      <p><a href={href('papers/')}>← Back to papers</a></p>
      <h1>{paper.data.title}</h1>
      <p>{paper.data.year}{paper.data.venue ? ` · ${paper.data.venue}` : ''}</p>
      <Content />
    </main>
  </body>
</html>
